# 🚀 Deploy Guide - Render.com (Free Tier)

## Por Que Render.com?

**Render.com** é a melhor opção gratuita para este projeto porque:

✅ **Tudo em um só lugar**: API + Redis + Frontend  
✅ **100% Gratuito**: Free tier generoso e permanente  
✅ **Auto-deploy**: Push to deploy automático  
✅ **Zero configuração**: Basta conectar o GitHub  
✅ **Suporte nativo**: Python, Redis, Static Sites  
✅ **HTTPS grátis**: SSL automático  
✅ **Custom domain**: Suporte gratuito  

## 📋 Pré-requisitos

- Conta no GitHub (você já tem)
- Conta no Render.com (criar gratuitamente)
- Este repositório no GitHub

## 🎯 Deploy em 5 Minutos

### Passo 1: Criar Conta no Render
1. Acesse https://render.com
2. Clique em "Get Started for Free"
3. Faça login com GitHub (recomendado)

### Passo 2: Conectar Repositório
1. No dashboard do Render, clique em "New +"
2. Selecione "Blueprint"
3. Conecte sua conta do GitHub
4. Selecione o repositório `ParkNow914/learning-ia`
5. Clique em "Apply"

### Passo 3: Deploy Automático
Render vai automaticamente:
- ✅ Criar 3 serviços (API, Redis, Frontend)
- ✅ Instalar dependências Python
- ✅ Configurar variáveis de ambiente
- ✅ Gerar chaves seguras automaticamente
- ✅ Configurar health checks
- ✅ Ativar HTTPS

**Tempo estimado**: 5-8 minutos

### Passo 4: Acessar Sistema
Após o deploy, você terá 3 URLs:

```
API:      https://learning-ia-api.onrender.com
Frontend: https://learning-ia-frontend.onrender.com
Redis:    (interno, não exposto publicamente)
```

## 🧪 Testar Deploy

### 1. Health Check
```bash
curl https://learning-ia-api.onrender.com/health
# Resposta: {"status":"healthy","timestamp":"..."}
```

### 2. API Key (obter do dashboard)
1. No Render dashboard, clique no serviço "learning-ia-api"
2. Vá em "Environment"
3. Copie o valor de `SECRET_API_KEY`

### 3. Fazer Predição
```bash
curl -X POST https://learning-ia-api.onrender.com/predict \
  -H "X-API-Key: <sua-chave-aqui>" \
  -H "Content-Type: application/json" \
  -d '{
    "interacoes": [
      {"questao_id": "q1", "correto": true, "tempo_resposta": 45},
      {"questao_id": "q2", "correto": false, "tempo_resposta": 120}
    ]
  }'
```

### 4. Acessar Frontend
Abra no navegador:
```
https://learning-ia-frontend.onrender.com
```

## 📊 Monitoramento

### Logs em Tempo Real
1. No dashboard do Render
2. Clique no serviço desejado
3. Aba "Logs" mostra logs estruturados

### Métricas
1. Aba "Metrics" mostra:
   - CPU usage
   - Memory usage
   - Request count
   - Response time

### Alertas
Configure em "Settings" > "Notifications":
- Deploy failed
- Service down
- High error rate

## 🔧 Configuração Avançada

### Custom Domain (Grátis)
1. No serviço, vá em "Settings" > "Custom Domain"
2. Adicione seu domínio (ex: `api.meudominio.com`)
3. Configure DNS conforme instruções
4. SSL automático em ~5 minutos

Exemplo de DNS:
```
Type: CNAME
Name: api
Value: learning-ia-api.onrender.com
```

### Variáveis de Ambiente
Editar em: Dashboard > Service > Environment

**Variáveis Importantes**:
```bash
# Segurança (geradas automaticamente)
SECRET_API_KEY=<auto-generated>
SALT_ANON=<auto-generated>

# Redis (conectado automaticamente)
REDIS_URL=<from-service>

# Rate Limiting
RATE_LIMIT_PER_MIN=60

# CORS (atualizar com seu domínio)
ALLOWED_ORIGINS=https://meu-dominio.com,https://learning-ia-frontend.onrender.com

# Modelo
MAX_SEQ_LEN=200
SEED=42

# Upload
MAX_UPLOAD_SIZE_MB=50
```

### Escalar (Upgrade)
Se precisar de mais recursos:

**Starter ($7/mo)**:
- ✅ Sem spin-down (sempre ativo)
- ✅ Redis persistente (500 MB)
- ✅ Suporte prioritário

**Standard ($25/mo)**:
- ✅ Auto-scaling
- ✅ Mais CPU/RAM
- ✅ Redis 1 GB

## 🐛 Troubleshooting

### Problema: "Service Unavailable" (503)
**Causa**: Free tier spin-down após 15 min inatividade  
**Solução**: 
- Aguarde 20-30s (cold start)
- Considere upgrade para Starter ($7/mo)

### Problema: Rate Limit não funciona
**Causa**: Redis free tier não persiste  
**Solução**: 
- Funciona normalmente durante sessão ativa
- Para persistência, upgrade para Starter

### Problema: Deploy falhou
**Causa**: Erro em requirements.txt ou código  
**Solução**:
1. Veja logs em "Logs" tab
2. Comum: `torch` é grande, pode demorar 5-10 min
3. Se timeout, faça re-deploy

### Problema: CORS error no frontend
**Causa**: Origin não permitida  
**Solução**: 
1. Atualize `ALLOWED_ORIGINS` no backend
2. Inclua URL do frontend: `https://learning-ia-frontend.onrender.com`

## 📈 Performance

### Free Tier Performance
- **Cold Start**: 20-30 segundos (após 15 min inatividade)
- **Warm**: < 200ms response time
- **Uptime**: 99.9% (com atividade regular)

### Otimizações
1. **Keep-alive**: Criar cron job para ping a cada 14 min
   ```bash
   # Em render.yaml, adicionar:
   - type: cron
     name: keep-alive
     schedule: "*/14 * * * *"
     command: "curl https://learning-ia-api.onrender.com/health"
   ```

2. **Cache**: Redis já configurado para LRU

3. **Compression**: GZip já ativo (70% menor)

## 🔐 Segurança

### Chaves Geradas
Render gera automaticamente:
- `SECRET_API_KEY`: Chave de autenticação
- `SALT_ANON`: Salt para anonimização

### Obter API Key
1. Dashboard > learning-ia-api > Environment
2. Copiar `SECRET_API_KEY`
3. Usar no header: `X-API-Key: <chave>`

### Rotar Chaves
1. Dashboard > Environment
2. Clicar em "Generate" ao lado da variável
3. Salvar nova chave
4. Atualizar clientes

## 🔄 CI/CD Automático

### Git Push = Auto Deploy
Já configurado! Basta fazer:

```bash
git add .
git commit -m "Nova feature"
git push origin main
```

Render detecta automaticamente e faz re-deploy em ~3-5 minutos.

### Status do Deploy
1. Dashboard mostra status em tempo real
2. Notificação por email quando completo
3. Logs disponíveis durante build

## 📚 Próximos Passos

### 1. Testar Sistema Completo
```bash
# Health check
curl https://learning-ia-api.onrender.com/health

# Fazer predição (com sua API key)
curl -X POST https://learning-ia-api.onrender.com/predict \
  -H "X-API-Key: SUA_CHAVE" \
  -H "Content-Type: application/json" \
  -d '{"interacoes": [...]}'
```

### 2. Configurar Custom Domain (Opcional)
- Mais profissional: `api.seudominio.com`
- SSL grátis e automático
- 5 minutos para configurar

### 3. Monitorar Logs
```bash
# Via CLI (instalar Render CLI)
render logs -s learning-ia-api -f

# Ou via dashboard
https://dashboard.render.com
```

### 4. Backup do Modelo
```bash
# Render tem persistent disk em planos pagos
# Free tier: recomenda-se armazenar modelo no GitHub ou S3
```

## 💰 Custo Total

### Free Tier (Forever)
- **API**: Free (750h/mês)
- **Redis**: Free (25 MB)
- **Frontend**: Free
- **SSL**: Free
- **Custom Domain**: Free
- **Total**: $0/mês ✅

### Upgrade Opcional
- **Starter**: $7/mês (sem spin-down)
- **Standard**: $25/mês (autoscaling)

## 📞 Suporte

### Documentação Oficial
- https://render.com/docs

### Community
- Discord: https://discord.gg/render
- Forum: https://community.render.com

### Issues
Para problemas específicos do projeto:
- GitHub Issues: https://github.com/ParkNow914/learning-ia/issues

## ✅ Checklist de Deploy

- [ ] Criar conta no Render
- [ ] Conectar repositório GitHub
- [ ] Aplicar Blueprint (render.yaml)
- [ ] Aguardar deploy (~5-8 min)
- [ ] Testar health check
- [ ] Copiar API key do dashboard
- [ ] Testar endpoint de predição
- [ ] Acessar frontend no navegador
- [ ] (Opcional) Configurar custom domain
- [ ] (Opcional) Configurar alertas

## 🎉 Pronto!

Seu sistema está no ar em:
- 🌐 **API**: https://learning-ia-api.onrender.com
- 🖥️ **Frontend**: https://learning-ia-frontend.onrender.com
- 📦 **Redis**: Conectado internamente

**Auto-deploy ativo**: Cada push = novo deploy automático! 🚀
