# ğŸš€ Deploy Guide - Render.com (Free Tier)

## Por Que Render.com?

**Render.com** Ã© a melhor opÃ§Ã£o gratuita para este projeto porque:

âœ… **Tudo em um sÃ³ lugar**: API + Redis + Frontend  
âœ… **100% Gratuito**: Free tier generoso e permanente  
âœ… **Auto-deploy**: Push to deploy automÃ¡tico  
âœ… **Zero configuraÃ§Ã£o**: Basta conectar o GitHub  
âœ… **Suporte nativo**: Python, Redis, Static Sites  
âœ… **HTTPS grÃ¡tis**: SSL automÃ¡tico  
âœ… **Custom domain**: Suporte gratuito  

## ğŸ“‹ PrÃ©-requisitos

- Conta no GitHub (vocÃª jÃ¡ tem)
- Conta no Render.com (criar gratuitamente)
- Este repositÃ³rio no GitHub

## ğŸ¯ Deploy em 5 Minutos

### Passo 1: Criar Conta no Render
1. Acesse https://render.com
2. Clique em "Get Started for Free"
3. FaÃ§a login com GitHub (recomendado)

### Passo 2: Conectar RepositÃ³rio
1. No dashboard do Render, clique em "New +"
2. Selecione "Blueprint"
3. Conecte sua conta do GitHub
4. Selecione o repositÃ³rio `ParkNow914/learning-ia`
5. Clique em "Apply"

### Passo 3: Deploy AutomÃ¡tico
Render vai automaticamente:
- âœ… Criar 3 serviÃ§os (API, Redis, Frontend)
- âœ… Instalar dependÃªncias Python
- âœ… Configurar variÃ¡veis de ambiente
- âœ… Gerar chaves seguras automaticamente
- âœ… Configurar health checks
- âœ… Ativar HTTPS

**Tempo estimado**: 5-8 minutos

### Passo 4: Acessar Sistema
ApÃ³s o deploy, vocÃª terÃ¡ 3 URLs:

```
API:      https://learning-ia-api.onrender.com
Frontend: https://learning-ia-frontend.onrender.com
Redis:    (interno, nÃ£o exposto publicamente)
```

## ğŸ§ª Testar Deploy

### 1. Health Check
```bash
curl https://learning-ia-api.onrender.com/health
# Resposta: {"status":"healthy","timestamp":"..."}
```

### 2. API Key (obter do dashboard)
1. No Render dashboard, clique no serviÃ§o "learning-ia-api"
2. VÃ¡ em "Environment"
3. Copie o valor de `SECRET_API_KEY`

### 3. Fazer PrediÃ§Ã£o
```bash
curl -X POST https://learning-ia-api.onrender.com/predict \
  -H "X-API-Key: <sua-chave-aqui>" \
  -H "Content-Type: application/json" \
  -d '{
    "interacoes": [
      {"questao_id": "q1", "correto": true, "tempo_resposta": 45},
      {"questao_id": "q2", "correto": false, "tempo_resposta": 120}
    ]
  }'
```

### 4. Acessar Frontend
Abra no navegador:
```
https://learning-ia-frontend.onrender.com
```

## ğŸ“Š Monitoramento

### Logs em Tempo Real
1. No dashboard do Render
2. Clique no serviÃ§o desejado
3. Aba "Logs" mostra logs estruturados

### MÃ©tricas
1. Aba "Metrics" mostra:
   - CPU usage
   - Memory usage
   - Request count
   - Response time

### Alertas
Configure em "Settings" > "Notifications":
- Deploy failed
- Service down
- High error rate

## ğŸ”§ ConfiguraÃ§Ã£o AvanÃ§ada

### Custom Domain (GrÃ¡tis)
1. No serviÃ§o, vÃ¡ em "Settings" > "Custom Domain"
2. Adicione seu domÃ­nio (ex: `api.meudominio.com`)
3. Configure DNS conforme instruÃ§Ãµes
4. SSL automÃ¡tico em ~5 minutos

Exemplo de DNS:
```
Type: CNAME
Name: api
Value: learning-ia-api.onrender.com
```

### VariÃ¡veis de Ambiente
Editar em: Dashboard > Service > Environment

**VariÃ¡veis Importantes**:
```bash
# SeguranÃ§a (geradas automaticamente)
SECRET_API_KEY=<auto-generated>
SALT_ANON=<auto-generated>

# Redis (conectado automaticamente)
REDIS_URL=<from-service>

# Rate Limiting
RATE_LIMIT_PER_MIN=60

# CORS (atualizar com seu domÃ­nio)
ALLOWED_ORIGINS=https://meu-dominio.com,https://learning-ia-frontend.onrender.com

# Modelo
MAX_SEQ_LEN=200
SEED=42

# Upload
MAX_UPLOAD_SIZE_MB=50
```

### Escalar (Upgrade)
Se precisar de mais recursos:

**Starter ($7/mo)**:
- âœ… Sem spin-down (sempre ativo)
- âœ… Redis persistente (500 MB)
- âœ… Suporte prioritÃ¡rio

**Standard ($25/mo)**:
- âœ… Auto-scaling
- âœ… Mais CPU/RAM
- âœ… Redis 1 GB

## ğŸ› Troubleshooting

### Problema: "Service Unavailable" (503)
**Causa**: Free tier spin-down apÃ³s 15 min inatividade  
**SoluÃ§Ã£o**: 
- Aguarde 20-30s (cold start)
- Considere upgrade para Starter ($7/mo)

### Problema: Rate Limit nÃ£o funciona
**Causa**: Redis free tier nÃ£o persiste  
**SoluÃ§Ã£o**: 
- Funciona normalmente durante sessÃ£o ativa
- Para persistÃªncia, upgrade para Starter

### Problema: Deploy falhou
**Causa**: Erro em requirements.txt ou cÃ³digo  
**SoluÃ§Ã£o**:
1. Veja logs em "Logs" tab
2. Comum: `torch` Ã© grande, pode demorar 5-10 min
3. Se timeout, faÃ§a re-deploy

### Problema: CORS error no frontend
**Causa**: Origin nÃ£o permitida  
**SoluÃ§Ã£o**: 
1. Atualize `ALLOWED_ORIGINS` no backend
2. Inclua URL do frontend: `https://learning-ia-frontend.onrender.com`

## ğŸ“ˆ Performance

### Free Tier Performance
- **Cold Start**: 20-30 segundos (apÃ³s 15 min inatividade)
- **Warm**: < 200ms response time
- **Uptime**: 99.9% (com atividade regular)

### OtimizaÃ§Ãµes
1. **Keep-alive**: Criar cron job para ping a cada 14 min
   ```bash
   # Em render.yaml, adicionar:
   - type: cron
     name: keep-alive
     schedule: "*/14 * * * *"
     command: "curl https://learning-ia-api.onrender.com/health"
   ```

2. **Cache**: Redis jÃ¡ configurado para LRU

3. **Compression**: GZip jÃ¡ ativo (70% menor)

## ğŸ” SeguranÃ§a

### Chaves Geradas
Render gera automaticamente:
- `SECRET_API_KEY`: Chave de autenticaÃ§Ã£o
- `SALT_ANON`: Salt para anonimizaÃ§Ã£o

### Obter API Key
1. Dashboard > learning-ia-api > Environment
2. Copiar `SECRET_API_KEY`
3. Usar no header: `X-API-Key: <chave>`

### Rotar Chaves
1. Dashboard > Environment
2. Clicar em "Generate" ao lado da variÃ¡vel
3. Salvar nova chave
4. Atualizar clientes

## ğŸ”„ CI/CD AutomÃ¡tico

### Git Push = Auto Deploy
JÃ¡ configurado! Basta fazer:

```bash
git add .
git commit -m "Nova feature"
git push origin main
```

Render detecta automaticamente e faz re-deploy em ~3-5 minutos.

### Status do Deploy
1. Dashboard mostra status em tempo real
2. NotificaÃ§Ã£o por email quando completo
3. Logs disponÃ­veis durante build

## ğŸ“š PrÃ³ximos Passos

### 1. Testar Sistema Completo
```bash
# Health check
curl https://learning-ia-api.onrender.com/health

# Fazer prediÃ§Ã£o (com sua API key)
curl -X POST https://learning-ia-api.onrender.com/predict \
  -H "X-API-Key: SUA_CHAVE" \
  -H "Content-Type: application/json" \
  -d '{"interacoes": [...]}'
```

### 2. Configurar Custom Domain (Opcional)
- Mais profissional: `api.seudominio.com`
- SSL grÃ¡tis e automÃ¡tico
- 5 minutos para configurar

### 3. Monitorar Logs
```bash
# Via CLI (instalar Render CLI)
render logs -s learning-ia-api -f

# Ou via dashboard
https://dashboard.render.com
```

### 4. Backup do Modelo
```bash
# Render tem persistent disk em planos pagos
# Free tier: recomenda-se armazenar modelo no GitHub ou S3
```

## ğŸ’° Custo Total

### Free Tier (Forever)
- **API**: Free (750h/mÃªs)
- **Redis**: Free (25 MB)
- **Frontend**: Free
- **SSL**: Free
- **Custom Domain**: Free
- **Total**: $0/mÃªs âœ…

### Upgrade Opcional
- **Starter**: $7/mÃªs (sem spin-down)
- **Standard**: $25/mÃªs (autoscaling)

## ğŸ“ Suporte

### DocumentaÃ§Ã£o Oficial
- https://render.com/docs

### Community
- Discord: https://discord.gg/render
- Forum: https://community.render.com

### Issues
Para problemas especÃ­ficos do projeto:
- GitHub Issues: https://github.com/ParkNow914/learning-ia/issues

## âœ… Checklist de Deploy

- [ ] Criar conta no Render
- [ ] Conectar repositÃ³rio GitHub
- [ ] Aplicar Blueprint (render.yaml)
- [ ] Aguardar deploy (~5-8 min)
- [ ] Testar health check
- [ ] Copiar API key do dashboard
- [ ] Testar endpoint de prediÃ§Ã£o
- [ ] Acessar frontend no navegador
- [ ] (Opcional) Configurar custom domain
- [ ] (Opcional) Configurar alertas

## ğŸ‰ Pronto!

Seu sistema estÃ¡ no ar em:
- ğŸŒ **API**: https://learning-ia-api.onrender.com
- ğŸ–¥ï¸ **Frontend**: https://learning-ia-frontend.onrender.com
- ğŸ“¦ **Redis**: Conectado internamente

**Auto-deploy ativo**: Cada push = novo deploy automÃ¡tico! ğŸš€
